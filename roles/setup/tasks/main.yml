- name: Ensure dotfiles repository is cloned to {{ user }} home directory.
  ansible.builtin.git:
    repo: https://github.com/ckiri/dotfiles
    dest: "/home/{{ user }}/.dotfiles"
    version: main
    force: true

- name: Ensure login shell of {{ user }} is set to `/bin/zsh`.
  ansible.builtin.command: usermod --shell /usr/bin/zsh {{ user }}
  become: true
  changed_when: false

- name: Ensure needed directories exist.
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
  loop:
    - "/home/{{ user }}/.cache/weather"
    - "/home/{{ user }}/.cache/zsh"

- name: Ensure needed files exist.
  ansible.builtin.file:
    path: "{{ item }}"
    state: touch
  loop:
    - "/home/{{ user }}/.cache/weather/weather"
    - "/home/{{ user }}/.cache/zsh/history"

- name: Ensure home directory is cleaned up.
  ansible.builtin.file:
    path: "{{ item }}"
    state: absent
  loop:
    - "/home/{{ user }}/.bashrc"
    - "/home/{{ user }}/.bash_history"
    - "/home/{{ user }}/.bash_logout"
    - "/home/{{ user }}/.ansible"
    - "/home/{{ user }}/Documents"
    - "/home/{{ user }}/Templates"
    - "/home/{{ user }}/Desktop"
    - "/home/{{ user }}/Downloads"
    - "/home/{{ user }}/Videos"
    - "/home/{{ user }}/Pictures"
    - "/home/{{ user }}/.config/user-dirs.dirs"
    - "/home/{{ user }}/Music"
    - "/home/{{ user }}/Public"
    - "/home/{{ user }}/.config/suckless/suckless-configs"

- name: Ensure symlinks are set.
  ansible.builtin.shell: "stow {{ item }}"
  args:
    chdir: "/home/{{ user }}/.dotfiles"
  loop:
    - alacritty
    - dunst
    - fontconfig
    - mpd
    - ncmpcpp
    - nvim
    - statusbar
    - sway
    - swaylock
    - sxhkd
    - tmux
    - wayshot
    - weather
    - zathura
